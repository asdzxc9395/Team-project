<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="Team.project.dao.ClazzMemberDao">
<resultMap type="ClazzMember" id="ClazzMemberMap">
  <id column="member_no" property="memberNo"/>
  <result column="user_no" property="userNo"/>
  <result column="class_no" property="clazzNo"/>
  <result column="role" property="role"/>
  
  <association property="user" javaType="User">
    <id column="user_no" property="userNo"/>
    <result column="name" property="name"/>
  </association>
  
</resultMap>

<select id="findByUserNoAndClassNo" resultMap="ClazzMemberMap" parameterType="map">
  select * from class_member
  where user_no = #{userNo} and class_no = #{classNo}
</select>

<select id="findAllByClassNo" resultMap="ClazzMemberMap" parameterType="int">
  select 
    cm.member_no,
    cm.class_no,
    cm.user_no,
    cm.role,
    u.name
  from 
    class_member cm
    inner join user u on cm.user_no = u.user_no
  where class_no = #{no}
</select>

<insert id="insert" parameterType="ClazzMember">
  insert into class_member(user_no, class_no, role) values(#{userNo}, #{clazzNo}, #{role})
</insert>
</mapper>